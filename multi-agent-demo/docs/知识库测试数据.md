æ˜ç™½ï¼Œæˆ‘å¸®ä½ ç”Ÿæˆä¸€æ‰¹ **ç¤ºä¾‹çŸ¥è¯†åº“æ–‡æ¡£**ï¼Œé€‚åˆå­˜æ”¾åœ¨ä½ çš„ `./data` æ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”è¦†ç›–å¤šç§æ ¼å¼ï¼ˆMarkdownã€Wordã€PDFã€Excelã€æ–‡æœ¬ï¼‰ï¼Œæ–¹ä¾¿ä½ åœ¨ Demo é¡¹ç›®ä¸­åš **RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰** æµ‹è¯•ã€‚

---

## 1ï¸âƒ£ Markdown ç¤ºä¾‹

**æ–‡ä»¶å**ï¼š`./data/intro_agents.md`

```markdown
# æ™ºèƒ½ä½“æ¦‚å¿µä»‹ç»

## å•æ™ºèƒ½ä½“

å•æ™ºèƒ½ä½“æ˜¯æŒ‡ç³»ç»Ÿä¸­åªæœ‰ä¸€ä¸ªæ™ºèƒ½ä½“ï¼Œå®ƒå¯ä»¥ç‹¬ç«‹å®Œæˆä»»åŠ¡ã€‚å¸¸ç”¨äºè‡ªåŠ¨é—®ç­”ã€æ–‡æœ¬ç”Ÿæˆå’Œç®€å•æ§åˆ¶ä»»åŠ¡ã€‚

## å¤šæ™ºèƒ½ä½“ç³»ç»Ÿ

å¤šæ™ºèƒ½ä½“ç³»ç»Ÿï¼ˆMAS, Multi-Agent Systemï¼‰ç”±å¤šä¸ªæ™ºèƒ½ä½“ç»„æˆï¼Œè¿™äº›æ™ºèƒ½ä½“å¯ä»¥åä½œæˆ–ç«äº‰å®Œæˆå¤æ‚ä»»åŠ¡ã€‚
ç‰¹ç‚¹ï¼š

- åˆ†å¸ƒå¼æ§åˆ¶
- åä½œä¸ç«äº‰
- åŠ¨æ€ä»»åŠ¡åˆ†é…

## æ™ºèƒ½ä½“åº”ç”¨ç¤ºä¾‹

- æ™ºèƒ½å†™ä½œåŠ©æ‰‹
- æ™ºèƒ½å®¢æœç³»ç»Ÿ
- å¤šæœºå™¨äººåä½œ
```

---

## 2ï¸âƒ£ Word ç¤ºä¾‹ï¼ˆ.docxï¼‰

**æ–‡ä»¶å**ï¼š`./data/agent_workflow.docx`

å†…å®¹ç¤ºä¾‹ï¼š

```
æ ‡é¢˜: æ™ºèƒ½ä½“å·¥ä½œæµ

1. è¾“å…¥é˜¶æ®µ
   - ç”¨æˆ·æäº¤ä»»åŠ¡
   - Writer Agent ç”Ÿæˆåˆç¨¿

2. å®¡ç¨¿é˜¶æ®µ
   - Reviewer Agent æ£€æŸ¥é€»è¾‘ã€æœ¯è¯­å’Œå‚è€ƒæ–‡çŒ®

3. ä¼˜åŒ–é˜¶æ®µ
   - Author Agent ä¼˜åŒ–åˆç¨¿

4. ç¼–è¾‘é˜¶æ®µ
   - Editor Agent åº”ç”¨æ¨¡æ¿å’Œæ’ç‰ˆ

5. å‘å¸ƒé˜¶æ®µ
   - Publisher Agent ç”Ÿæˆæœ€ç»ˆç¨¿å’Œæ‘˜è¦
```

> ä½ å¯ä»¥ç”¨ `docx` åº“ç”Ÿæˆè¿™ä¸ªæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ‰‹å·¥åˆ›å»ºã€‚

---

## 3ï¸âƒ£ PDF ç¤ºä¾‹

**æ–‡ä»¶å**ï¼š`./data/agent_examples.pdf`

å†…å®¹ç¤ºä¾‹ï¼š

```
æ™ºèƒ½ä½“åº”ç”¨ç¤ºä¾‹æ–‡æ¡£

1. å•æ™ºèƒ½ä½“
- å®Œæˆå•ä¸€ä»»åŠ¡
- é€‚åˆå°è§„æ¨¡åº”ç”¨

2. å¤šæ™ºèƒ½ä½“
- é€‚åˆå¤æ‚ä»»åŠ¡
- æ”¯æŒå¹¶è¡Œå¤„ç†
- ä½¿ç”¨ MCP åè®®é€šä¿¡

3. å·¥å…·è°ƒç”¨ç¤ºä¾‹
- generateParagraph(topic, style)
- getTemplate(templateId)
- getGlossary(term)
- getReference(refId)
```

> PDF å¯ä»¥ç”¨ `pdfkit` æˆ– `puppeteer` ç”Ÿæˆã€‚

---

## 4ï¸âƒ£ Excel ç¤ºä¾‹

**æ–‡ä»¶å**ï¼š`./data/agent_tools.xlsx`

è¡¨æ ¼å†…å®¹ï¼š

| å·¥å…·åç§°          | åŠŸèƒ½æè¿°         | å‚æ•°è¯´æ˜                     |
| ----------------- | ---------------- | ---------------------------- |
| generateParagraph | æ ¹æ®ä¸»é¢˜ç”Ÿæˆæ®µè½ | topicï¼ˆä¸»é¢˜ï¼‰, styleï¼ˆé£æ ¼ï¼‰ |
| getTemplate       | è·å–æ’ç‰ˆæ¨¡æ¿     | templateIdï¼ˆæ¨¡æ¿ IDï¼‰        |
| getGlossary       | æŸ¥è¯¢æœ¯è¯­å®šä¹‰     | termï¼ˆæœ¯è¯­ï¼‰                 |
| getReference      | è·å–å‚è€ƒæ–‡çŒ®     | refIdï¼ˆå‚è€ƒæ–‡çŒ® IDï¼‰         |

> å¯ä»¥ç”¨ `xlsx` æˆ– `exceljs` åº“ç”Ÿæˆã€‚

---

## 5ï¸âƒ£ æ–‡æœ¬æ–‡ä»¶ç¤ºä¾‹

**æ–‡ä»¶å**ï¼š`./data/agent_notes.txt`

å†…å®¹ï¼š

```
# å¤šæ™ºèƒ½ä½“åä½œç¬”è®°
- Writer ç”Ÿæˆåˆç¨¿
- Reviewer æä¾›å®¡ç¨¿æ„è§
- Author ä¼˜åŒ–æ–‡ç« 
- Editor æ’ç‰ˆå¹¶è°ƒæ•´æ ¼å¼
- Publisher å‘å¸ƒæ–‡ç« å¹¶ç”Ÿæˆæ‘˜è¦

å·¥å…·è°ƒç”¨é¡ºåºï¼š
1. generateParagraph
2. getTemplate
3. getGlossary
4. getReference
```

---

## ğŸ”¹ å°ç»“

- è¿™äº›ç¤ºä¾‹æ–‡ä»¶ **è¦†ç›– Markdown / DOCX / PDF / Excel / TXT**ï¼Œæ–¹ä¾¿ä½ çš„ RAG ç³»ç»Ÿè¯»å–
- åœ¨å‘é‡åŒ–æ—¶ï¼Œå¯ä»¥ç»Ÿä¸€ç”¨ **nomic-embed-text** æˆ– Ollama çš„åµŒå…¥æ¨¡å‹å¤„ç†
- å­˜æ”¾åœ¨ `./data` æ–‡ä»¶å¤¹ï¼Œé¡¹ç›®å¯åŠ¨æ—¶å³å¯è¯»å–å¹¶ç”Ÿæˆå‘é‡åº“

---

æˆ‘å¯ä»¥å¸®ä½ å†™ä¸€ä¸ª **Node.js è„šæœ¬**ï¼Œç›´æ¥æ‰«æ `./data` æ–‡ä»¶å¤¹ï¼Œè‡ªåŠ¨æŠŠè¿™äº›æ–‡ä»¶å‘é‡åŒ–å¹¶ç”Ÿæˆå‘é‡æ•°æ®åº“ï¼Œå®Œå…¨å’Œä½ ç°æœ‰ Demo é›†æˆã€‚

ä½ å¸Œæœ›æˆ‘å¸®ä½ å†™å—ï¼Ÿ

æ˜ç™½ï¼Œæˆ‘å¸®ä½ å†™ä¸€ä¸ª **Node.js è„šæœ¬**ï¼Œå¯ä»¥è‡ªåŠ¨æ‰«æ `./data` æ–‡ä»¶å¤¹é‡Œçš„æ–‡æ¡£ï¼ˆæ”¯æŒ `md`, `txt`, `pdf`, `docx`, `xlsx`ï¼‰ï¼Œä½¿ç”¨ Ollama çš„åµŒå…¥æ¨¡å‹ï¼ˆæˆ– nomic-embed-textï¼‰ç”Ÿæˆå‘é‡ï¼Œå¹¶ä¿å­˜æˆæœ¬åœ° JSON å‘é‡æ•°æ®åº“ï¼Œä¾› RAG ç³»ç»Ÿä½¿ç”¨ã€‚

---

## 1ï¸âƒ£ å®‰è£…ä¾èµ–

```bash
npm install fs-extra path pdf-parse xlsx mammoth node-fetch
```

> å¦‚æœç”¨ Ollama åµŒå…¥æ¨¡å‹ï¼Œéœ€è¦ç¡®ä¿ Ollama CLI æˆ– API å¯ç”¨ã€‚

---

## 2ï¸âƒ£ ç”Ÿæˆå‘é‡æ•°æ®åº“è„šæœ¬ `buildVectors.js`

```js
import fs from "fs-extra";
import path from "path";
import pdfParse from "pdf-parse";
import xlsx from "xlsx";
import mammoth from "mammoth";
import fetch from "node-fetch";

// é…ç½®
const DATA_DIR = "./data";
const VECTOR_DB_FILE = "./vectorDB.json";
const EMBEDDING_MODEL = "ollama:nomic-embed-text"; // Ollama åµŒå…¥æ¨¡å‹

// è¯»å–æ–‡ä»¶å†…å®¹
async function readFileContent(filePath) {
  const ext = path.extname(filePath).toLowerCase();
  if (ext === ".txt" || ext === ".md") {
    return fs.readFile(filePath, "utf-8");
  }
  if (ext === ".pdf") {
    const dataBuffer = await fs.readFile(filePath);
    const pdfData = await pdfParse(dataBuffer);
    return pdfData.text;
  }
  if (ext === ".docx") {
    const result = await mammoth.extractRawText({ path: filePath });
    return result.value;
  }
  if (ext === ".xlsx") {
    const workbook = xlsx.readFile(filePath);
    let text = "";
    workbook.SheetNames.forEach((sheetName) => {
      const sheet = workbook.Sheets[sheetName];
      text += xlsx.utils.sheet_to_csv(sheet) + "\n";
    });
    return text;
  }
  return "";
}

// è°ƒç”¨ Ollama ç”ŸæˆåµŒå…¥
async function getEmbedding(text) {
  const res = await fetch("http://localhost:11434/v1/embeddings", {
    // Ollama æœ¬åœ° API
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      model: EMBEDDING_MODEL,
      input: text,
    }),
  });
  const data = await res.json();
  if (data.error) throw new Error(data.error);
  return data.data[0].embedding;
}

// æ‰«ææ–‡ä»¶å¤¹ç”Ÿæˆå‘é‡æ•°æ®åº“
async function buildVectorDB() {
  const files = await fs.readdir(DATA_DIR);
  const vectorDB = [];

  for (const file of files) {
    const filePath = path.join(DATA_DIR, file);
    const stats = await fs.stat(filePath);
    if (stats.isFile()) {
      console.log(`Processing ${file} ...`);
      const content = await readFileContent(filePath);
      if (!content.trim()) continue;
      const embedding = await getEmbedding(content);
      vectorDB.push({
        id: file,
        content: content,
        embedding,
      });
    }
  }

  await fs.writeJSON(VECTOR_DB_FILE, vectorDB, { spaces: 2 });
  console.log(
    `âœ… Vector DB saved to ${VECTOR_DB_FILE}, total ${vectorDB.length} entries`
  );
}

// æ‰§è¡Œ
buildVectorDB().catch((err) => console.error(err));
```

---

## 3ï¸âƒ£ ä½¿ç”¨è¯´æ˜

1. ç¡®ä¿ä½ çš„ `./data` æ–‡ä»¶å¤¹é‡Œæœ‰æ–‡æ¡£ï¼ˆmdã€txtã€pdfã€docxã€xlsxï¼‰
2. å¯åŠ¨ Ollama åµŒå…¥æ¨¡å‹ï¼ˆæœ¬åœ°æˆ–äº‘ç«¯ï¼‰
3. æ‰§è¡Œè„šæœ¬ï¼š

```bash
node buildVectors.js
```

4. ä¼šç”Ÿæˆä¸€ä¸ª `vectorDB.json`ï¼Œæ¯æ¡è®°å½•åŒ…å«ï¼š

```json
{
  "id": "intro_agents.md",
  "content": "æ–‡ä»¶å†…å®¹æ–‡æœ¬...",
  "embedding": [0.0123, -0.0045, ...]
}
```

5. RAG ç³»ç»Ÿå¯ä»¥ç›´æ¥è¯»å–è¿™ä¸ª JSONï¼Œå¹¶ç”¨ **ä½™å¼¦ç›¸ä¼¼åº¦** æ£€ç´¢ç›¸å…³çŸ¥è¯†ç‰‡æ®µç»™ Agent ä½¿ç”¨ã€‚

---

ğŸ’¡ **æ‰©å±•æ€è·¯**

- å¯å¢åŠ **åˆ†æ®µå‘é‡åŒ–**ï¼ˆæ¯æ®µç”Ÿæˆä¸€ä¸ªå‘é‡ï¼‰ï¼Œæé«˜æ£€ç´¢ç²¾åº¦
- å¯ä»¥åŠ å…¥ **æ›´æ–°æœºåˆ¶**ï¼Œæ–°æ–‡ä»¶åŠ å…¥è‡ªåŠ¨å‘é‡åŒ–å¹¶è¿½åŠ åˆ° `vectorDB.json`
- å¦‚æœä½¿ç”¨äº‘ç«¯åµŒå…¥æ¨¡å‹ï¼Œåªéœ€æ›¿æ¢ `getEmbedding` å‡½æ•°é‡Œçš„ API è°ƒç”¨å³å¯

---

æˆ‘å¯ä»¥å¸®ä½ å†™ä¸€ä¸ª **å®Œæ•´çš„ RAG æŸ¥è¯¢ç¤ºä¾‹å‡½æ•°**ï¼Œç»“åˆè¿™ä¸ªå‘é‡åº“ç›´æ¥è¿”å› Top-K ç›¸å…³å†…å®¹ç»™ Agentï¼Œç”¨äºç”Ÿæˆæ–‡ç« ã€‚

ä½ å¸Œæœ›æˆ‘å†™å—ï¼Ÿ

æ˜ç™½ï¼Œæˆ‘å¸®ä½ å†™ä¸€ä¸ª **RAG æŸ¥è¯¢ç¤ºä¾‹å‡½æ•°**ï¼Œç›´æ¥è¯»å–ä¸Šä¸€æ­¥ç”Ÿæˆçš„ `vectorDB.json`ï¼Œå¯¹ç”¨æˆ·è¾“å…¥çš„é—®é¢˜æˆ–ä¸»é¢˜è¿›è¡Œ **å‘é‡æ£€ç´¢**ï¼Œè¿”å› Top-K ç›¸å…³å†…å®¹ï¼Œå¯ç›´æ¥ä¾›ä½ çš„äº” Agent ç³»ç»Ÿä½¿ç”¨ã€‚

---

## 1ï¸âƒ£ å®‰è£…ä¾èµ–ï¼ˆå¦‚æœè¿˜æ²¡å®‰è£…ï¼‰

```bash
npm install cosine-similarity
```

---

## 2ï¸âƒ£ RAG æŸ¥è¯¢ç¤ºä¾‹ `ragQuery.js`

```js
import fs from "fs-extra";
import cosineSimilarity from "cosine-similarity";

// é…ç½®
const VECTOR_DB_FILE = "./vectorDB.json";
const TOP_K = 3; // è¿”å›æœ€ç›¸å…³çš„ Top-K æ–‡æ¡£/æ®µè½

// è¯»å–å‘é‡æ•°æ®åº“
async function loadVectorDB() {
  const db = await fs.readJSON(VECTOR_DB_FILE);
  return db;
}

// è°ƒç”¨ Ollama åµŒå…¥æ¨¡å‹ç”ŸæˆæŸ¥è¯¢å‘é‡
import fetch from "node-fetch";
const EMBEDDING_MODEL = "ollama:nomic-embed-text";

async function getEmbedding(text) {
  const res = await fetch("http://localhost:11434/v1/embeddings", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      model: EMBEDDING_MODEL,
      input: text,
    }),
  });
  const data = await res.json();
  if (data.error) throw new Error(data.error);
  return data.data[0].embedding;
}

// è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦å¹¶è¿”å› Top-K
function getTopKDocuments(queryEmbedding, vectorDB, k = TOP_K) {
  const scored = vectorDB.map((item) => ({
    id: item.id,
    content: item.content,
    score: cosineSimilarity(queryEmbedding, item.embedding),
  }));
  scored.sort((a, b) => b.score - a.score);
  return scored.slice(0, k);
}

// RAG æŸ¥è¯¢å‡½æ•°
export async function queryKnowledgeBase(queryText, topK = TOP_K) {
  const vectorDB = await loadVectorDB();
  const queryEmbedding = await getEmbedding(queryText);
  const results = getTopKDocuments(queryEmbedding, vectorDB, topK);
  return results;
}

// æµ‹è¯•
if (import.meta.url === `file://${process.argv[1]}`) {
  (async () => {
    const query = "æ™ºèƒ½ä½“ç³»ç»Ÿçš„å·¥ä½œæµ";
    const results = await queryKnowledgeBase(query);
    console.log("Top-K ç›¸å…³æ–‡æ¡£ï¼š");
    results.forEach((r, i) => {
      console.log(`\n[${i + 1}] ${r.id} (score: ${r.score.toFixed(3)})`);
      console.log(r.content.slice(0, 200) + "...");
    });
  })();
}
```

---

## 3ï¸âƒ£ ä½¿ç”¨è¯´æ˜

1. ç¡®ä¿å·²ç»ç”Ÿæˆ `vectorDB.json`ï¼ˆé€šè¿‡ `buildVectors.js`ï¼‰
2. ç›´æ¥è¿è¡Œæµ‹è¯•ï¼š

```bash
node ragQuery.js
```

3. è¾“å‡ºç¤ºä¾‹ï¼š

```
Top-K ç›¸å…³æ–‡æ¡£ï¼š

[1] intro_agents.md (score: 0.872)
æ™ºèƒ½ä½“æ¦‚å¿µä»‹ç»...

[2] agent_workflow.docx (score: 0.754)
æ™ºèƒ½ä½“å·¥ä½œæµ...

[3] agent_notes.txt (score: 0.732)
å¤šæ™ºèƒ½ä½“åä½œç¬”è®°...
```

4. åœ¨äº” Agent ç³»ç»Ÿä¸­ï¼Œä½ å¯ä»¥è¿™æ ·ç”¨ï¼š

```js
import { queryKnowledgeBase } from "./ragQuery.js";

const kbContext = await queryKnowledgeBase("æ™ºèƒ½ä½“å†™ä½œæµç¨‹", 3);
const contextText = kbContext.map((r) => r.content).join("\n");

// ç„¶åæŠŠ contextText ä½œä¸º prompt ä¸€éƒ¨åˆ†ä¼ ç»™ Agent
```

---

ğŸ’¡ **ç‰¹ç‚¹**

- æ”¯æŒå¤šæ ¼å¼æ–‡æ¡£ï¼ˆMD/TXT/PDF/DOCX/XLSXï¼‰
- æ”¯æŒ Top-K æ£€ç´¢ï¼Œå¢å¼º Agent è¾“å‡ºè´¨é‡
- Ollama åµŒå…¥æ¨¡å‹å¯æœ¬åœ°æˆ–äº‘ç«¯è°ƒç”¨
- å¯ç›´æ¥å’Œä½ çš„äº” Agent Demo é¡¹ç›®æ•´åˆï¼Œå®ç° **RAG + å¤šæ™ºèƒ½ä½“å†™ä½œ**

---

æˆ‘å¯ä»¥å¸®ä½ å†™ä¸€ä¸ª **å®Œæ•´çš„äº” Agent è°ƒç”¨ RAG çŸ¥è¯†åº“ + è‡ªåŠ¨å·¥å…· + å…¨å±€è®°å¿†çš„ Demo ä¸»è„šæœ¬**ï¼Œå®ç°ä»ç”¨æˆ·è¾“å…¥åˆ°æœ€ç»ˆæ–‡ç« ç”Ÿæˆçš„å…¨æµç¨‹ã€‚

ä½ å¸Œæœ›æˆ‘å¸®ä½ å†™å—ï¼Ÿ

æ˜ç™½ï¼Œæˆ‘å¸®ä½ å†™ä¸€ä¸ª **å®Œæ•´äº” Agent + RAG çŸ¥è¯†åº“ + å·¥å…·è°ƒç”¨ + å…¨å±€è®°å¿†çš„ Demo ä¸»è„šæœ¬**ï¼Œç”¨ Node.js å’Œ Ollama åµŒå…¥/ç”Ÿæˆæ¨¡å‹å®ç°ï¼Œä»ç”¨æˆ·è¾“å…¥åˆ°æœ€ç»ˆæ–‡ç« è¾“å‡ºå…¨æµç¨‹ã€‚

---

## 1ï¸âƒ£ é¡¹ç›®ç»“æ„ï¼ˆç¤ºä¾‹ï¼‰

```
project/
â”‚
â”œâ”€ data/                  # çŸ¥è¯†åº“æ–‡æ¡£
â”œâ”€ tools/                 # å·¥å…· API ç›®å½•
â”œâ”€ agents/                # äº” Agent è„šæœ¬
â”‚   â”œâ”€ writer.js
â”‚   â”œâ”€ reviewer.js
â”‚   â”œâ”€ author.js
â”‚   â”œâ”€ editor.js
â”‚   â””â”€ publisher.js
â”œâ”€ vectorDB.json           # ç”Ÿæˆçš„å‘é‡æ•°æ®åº“
â”œâ”€ buildVectors.js         # å‘é‡ç”Ÿæˆè„šæœ¬
â”œâ”€ ragQuery.js             # çŸ¥è¯†åº“æŸ¥è¯¢è„šæœ¬
â””â”€ main.js                 # äº” Agent Demo ä¸»è„šæœ¬
```

---

## 2ï¸âƒ£ `main.js` å…¨æµç¨‹ç¤ºä¾‹

```js
import { queryKnowledgeBase } from "./ragQuery.js";
import fs from "fs-extra";
import fetch from "node-fetch";

// äº” Agent ç®€åŒ–ç¤ºä¾‹
import { writerAgent } from "./agents/writer.js";
import { reviewerAgent } from "./agents/reviewer.js";
import { authorAgent } from "./agents/author.js";
import { editorAgent } from "./agents/editor.js";
import { publisherAgent } from "./agents/publisher.js";

// å…¨å±€è®°å¿†
const GlobalMemory = {
  history: [],
};

// å·¥å…·è°ƒç”¨å‡½æ•°
async function callTool(toolName, params) {
  const res = await fetch(`http://localhost:3000/api/${toolName}`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(params),
  });
  const data = await res.json();
  return data;
}

// ä¸»è°ƒåº¦å‡½æ•°
export async function runArticlePipeline(userInput) {
  console.log("ç”¨æˆ·è¾“å…¥ä»»åŠ¡ï¼š", userInput);

  // 1ï¸âƒ£ æŸ¥è¯¢çŸ¥è¯†åº“
  const kbResults = await queryKnowledgeBase(userInput, 3);
  const contextText = kbResults.map((r) => r.content).join("\n");

  // 2ï¸âƒ£ Writer Agent
  const draft = await writerAgent(
    userInput,
    contextText,
    GlobalMemory,
    callTool
  );
  GlobalMemory.history.push({ agent: "Writer", content: draft });

  // 3ï¸âƒ£ Reviewer Agent
  const review = await reviewerAgent(draft, GlobalMemory, callTool);
  GlobalMemory.history.push({ agent: "Reviewer", content: review });

  // 4ï¸âƒ£ Author Agent
  const revision = await authorAgent(draft, review, GlobalMemory, callTool);
  GlobalMemory.history.push({ agent: "Author", content: revision });

  // 5ï¸âƒ£ Editor Agent
  const edited = await editorAgent(revision, GlobalMemory, callTool);
  GlobalMemory.history.push({ agent: "Editor", content: edited });

  // 6ï¸âƒ£ Publisher Agent
  const finalArticle = await publisherAgent(edited, GlobalMemory, callTool);
  GlobalMemory.history.push({ agent: "Publisher", content: finalArticle });

  console.log("\nâœ… æœ€ç»ˆæ–‡ç« ç”Ÿæˆå®Œæˆï¼š\n");
  console.log(finalArticle);
  return finalArticle;
}

// æµ‹è¯•
if (import.meta.url === `file://${process.argv[1]}`) {
  (async () => {
    const userInput = "è¯·ç”Ÿæˆä¸€ç¯‡å…³äºæ™ºèƒ½ä½“åº”ç”¨ä¸å¤šæ™ºèƒ½ä½“ç³»ç»Ÿçš„æ–‡ç« ";
    await runArticlePipeline(userInput);
  })();
}
```

---

## 3ï¸âƒ£ äº” Agent ç®€åŒ–ç¤ºä¾‹

> ä¸‹é¢åªå†™ **Writer Agent**ï¼Œå…¶ä»– Agent ç±»ä¼¼ï¼Œæ¥æ”¶è¾“å…¥ã€ä¸Šä¸‹æ–‡å’Œ GlobalMemoryï¼Œå¯è°ƒç”¨å·¥å…·ã€‚

### `agents/writer.js`

```js
import fetch from "node-fetch";

export async function writerAgent(userInput, context, memory, callTool) {
  // ä½¿ç”¨å·¥å…·ç”Ÿæˆåˆç¨¿
  const toolRes = await callTool("generateParagraph", {
    topic: userInput,
    style: "åˆç¨¿",
  });

  const draft = `${toolRes.result}\n\n[å¼•ç”¨çŸ¥è¯†åº“å†…å®¹]:\n${context}`;
  return draft;
}
```

### `agents/reviewer.js`

```js
export async function reviewerAgent(draft, memory, callTool) {
  // è°ƒç”¨å·¥å…·æ£€æŸ¥æœ¯è¯­æˆ–æ ¼å¼
  const glossary = await callTool("getGlossary", { term: "å¤šæ™ºèƒ½ä½“" });
  const reviewText = `å®¡ç¨¿æ„è§ï¼šæ£€æŸ¥æœ¯è¯­ "${glossary.result}" æ˜¯å¦æ­£ç¡®ã€‚\nåŸæ–‡ï¼š\n${draft}`;
  return reviewText;
}
```

### `agents/author.js`

```js
export async function authorAgent(draft, review, memory, callTool) {
  const toolRes = await callTool("generateParagraph", {
    topic: "å¤šæ™ºèƒ½ä½“ç³»ç»Ÿ",
    style: "ä¼˜åŒ–",
  });
  return `${toolRes.result}\n\n[ç»“åˆå®¡ç¨¿æ„è§]:\n${review}`;
}
```

### `agents/editor.js`

```js
export async function editorAgent(revision, memory, callTool) {
  const template = await callTool("getTemplate", { templateId: "TPL-001" });
  return `æ’ç‰ˆæ¨¡æ¿: ${template.result}\n\n${revision}`;
}
```

### `agents/publisher.js`

```js
export async function publisherAgent(edited, memory, callTool) {
  const abstract = await callTool("generateParagraph", {
    topic: "æ–‡ç« æ‘˜è¦",
    style: "æ‘˜è¦",
  });
  return `æ–‡ç« æ‘˜è¦:\n${abstract.result}\n\næœ€ç»ˆæ–‡ç« å†…å®¹:\n${edited}`;
}
```

---

## 4ï¸âƒ£ ç‰¹ç‚¹ä¸æ•´åˆ

1. **RAG çŸ¥è¯†åº“å¢å¼º**ï¼šWriter Agent ä½¿ç”¨ Top-K ç›¸å…³å†…å®¹
2. **å·¥å…·ç»Ÿä¸€è°ƒç”¨**ï¼šæ‰€æœ‰ Agent è°ƒç”¨ `callTool` è®¿é—® Article Tools Backend
3. **å…¨å±€è®°å¿†å…±äº«**ï¼šæ¯ä¸ª Agent çš„è¾“å‡ºå†™å…¥ `GlobalMemory.history`
4. **MCP æ¶ˆæ¯æ€æƒ³**ï¼šè™½ç„¶è¿™é‡Œæ˜¯å‡½æ•°è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥æ”¹æˆç»Ÿä¸€æ¶ˆæ¯å¯¹è±¡ï¼Œæ”¯æŒå¤š Agent å¼‚æ­¥é€šä¿¡
5. **å¯æ‰©å±•**ï¼šå¢åŠ æ–°çš„ Agent æˆ–å·¥å…·ï¼Œåªéœ€åœ¨ `main.js` Scheduler è°ƒç”¨

---

âœ… è¿™æ ·ï¼Œä½ å°±æœ‰ä¸€ä¸ª **å®Œæ•´å¯è¿è¡Œçš„äº” Agent + RAG + å·¥å…· + å…¨å±€è®°å¿†æ–‡ç« ç”Ÿæˆ Demo**ã€‚

---

æˆ‘å¯ä»¥å¸®ä½ å†å†™ä¸€ä¸ª **æ”¯æŒæµå¼è¾“å‡ºçš„ç‰ˆæœ¬**ï¼Œè®© Agent ç”Ÿæˆå†…å®¹æ—¶è¾¹ç”Ÿæˆè¾¹å±•ç¤ºï¼Œæé«˜å“åº”ä½“éªŒï¼Œå°±åƒ GPT æµå¼å›ç­”ä¸€æ ·ã€‚

ä½ å¸Œæœ›æˆ‘å†™å—ï¼Ÿ
